testCommonCode;


GInvParam.isParallel = 1;
GInvParam.isPrintBySavingFile = 0;

% 23, 21, 18, 53, 80, 75
% 53, 81
% 50 80

[inIds, crossIds] = bsGetProfileCrossingWells(GInvParam, wellLogs([23, 21, 18, 53, 80, 75]), ...
    'isAlongCrossline', 0);

% ids = bsGetIdsFromWelllogs(wellLogs, {'W2-2132'});

% [inIds, crossIds] = bsGetProfileCrossingWells(GInvParam, wellLogs(ids), ...
%     'isAlongCrossline', 1);

% inverse a profile
% [~, ~, GInvParam, data] = bsBuildInitModel(GInvParam, timeLine, wellLogs, ...
%     'title', 'cross_well', ...
%     'inIds', inIds, ...
%     'filtCoef', 0.1, ...
%     'crossIds', crossIds, ...
%     'isRebuild', 1, ...
%     'p', 2, ...
%     'nPointsUsed', 6 ...
% );

gamma = 1;

methods = {
    
    struct(...
        'name', '地震数据', ...
        'type', 'Seismic', ...
        'load', struct(...
            'mode', 'segy', ...
            'fileName', [basePath, '/seismic/seismic.sgy'], ...
            'segyInfo', bsSetFields(GSegyInfo, {'inlineId', 9; 'crossId', 21; 't0', 0; 'isNegative', 0}) ...
        )...
    );...

    struct(...
        'name', '地震数据 (90°相移)', ...
        'type', 'Seismic', ...
        'load', struct(...
            'mode', 'segy', ...
            'fileName', [basePath, '/seismic/phase_shift_90.sgy'], ...
            'segyInfo', bsSetFields(GSegyInfo, {'inlineId', 9; 'crossId', 21; 't0', 0; 'isNegative', 0}) ...
        )...
    );...
    
    
    struct(...
        'name', '初始模型', ...
        'isSaveMat', 0, ...
        'load', struct(...
            'mode', 'segy', ...
            'fileName', GInvParam.initModel.ip.fileName, ...
            'segyInfo', GInvParam.initModel.ip.segyInfo ...
        )...
    );...
%     
%     struct(...
%         'name', '普通方法', ...
%         'flag', 'LFC', ...
%         'regParam', 0.2, ...
%         'parampkgs', [], ...
%         'options', bsSetFields(GInvParam.seisInvOptions, {'maxIter', 50;}), ...
%         'showFiltCoef', 0, ...
%         'isSaveMat', 0 ...
%     ); 
    
%     struct(...
%         'name', '字典反演结果 lambda=0.2', ...
%         'flag', 'DLSR', ...
%         'regParam', struct('lambda', 0.4, 'gamma', 0.2), ...
%         'parampkgs', bsSetFields(GSparseInvParam, {'sparsity', 1}), ...
%         'options', bsSetFields(GInvParam.seisInvOptions, ...
%             {'maxIter', 5; 'innerIter', 40; 'initRegParam', 0.2}), ...
%         'showFiltCoef', 0.8 ...
%     );
%     
%     struct(...
%         'name', '字典反演结果 \gamma=0.1', ...
%         'flag', 'DLSR', ...
%         'regParam', struct('lambda', 0.4, 'gamma', 0.1), ...
%         'parampkgs', bsSetFields(GSparseInvParam, {'sparsity', 1;}), ...
%         'options', bsSetFields(GInvParam.seisInvOptions, ...
%             {'maxIter', 10; 'innerIter', 5; 'initRegParam', 0.2}), ...
%         'showFiltCoef', 1 ...
%     );
    
    struct(...
        'name', '字典反演结果 \gamma=0.4', ...
        'flag', 'DLSR', ...
        'regParam', struct('lambda', 0.4, 'gamma', 0.4), ...
        'parampkgs', bsSetFields(GSparseInvParam, {'sparsity', 1; 'isChangeK', 1}), ...
        'options', bsSetFields(GInvParam.seisInvOptions, ...
            {'maxIter', 10; 'innerIter', 5; 'initRegParam', 0.2}), ...
        'showFiltCoef', 1 ...
    );
    
%     struct(...
%         'name', '地质统计学结果', ...
%         'isSaveMat', 0, ...
%         'load', struct(...
%             'mode', 'segy', ...
%             'fileName', [basePath, '\chenting\0206SMIResult_wellnumber15modifychoosewellnewhor.sgy'], ...
%             'segyInfo', bsSetFields(GSegyInfo, {'inlineId', 9; 'crossId', 21; 't0', 0}) ...
%         )...
%     );...
%     
    
%     
%     
    struct(...
        'name', '稀疏脉冲', ...
        'isSaveMat', 0, ...
        'load', struct(...
            'mode', 'segy', ...
            'fileName', [basePath, '\inv_result\geoeast_impedance_sparse_impulse_bgp.sgy'], ...
            'segyInfo', bsSetFields(GSegyInfo, {'inlineId', 189; 'crossId', 21; 't0', 780}) ...
        )...
    );...
% % %     
%     
% % %     
};

% perform the inversion process based on given methods
invResults = bsPostInvTrueMultiTraces(GInvParam, inIds, crossIds, timeLine, methods);

% invResults = [{bsSetFields(invResults{1}, {'name', 'Minus error model'; 'data', usedData})}, invResults];
% NLMResults = invResults;
% NLMResults(4:end) = bsNLMInvResults(invResults(4:end), [], ...
%     'searchOffset', 3, 'windowSize', [1, 3], 'nPointsUsed', 3, ...
%     'stride', [1, 1, 1], 'searchStride', [1, 1, 1] ...
% );

% for i = 1 : length(invResults)
%     
% end

% GShowProfileParam.range.ip = [6000 7800];
GShowProfileParam.range.ip = [5800 7600];
GShowProfileParam.range.seismic = [-3 3]*1e4;
GShowProfileParam.colormap.allTheSame = bsGetColormap('velocity');
GShowProfileParam.colormap.seismic = flipud(bsGetColormap('seismic'));
GShowProfileParam.isColorReverse = 0;

GShowProfileParam.scaleFactor = 4;
GShowProfileParam.showWellOffset = 1;
GShowProfileParam.isShowColorWells = 1;
GShowProfileParam.plotParam.fontsize = 11;
GShowProfileParam.plotParam.fontname = '仿宋';
% GShowProfileParam.showPartVert.upTime = 5;
% GShowProfileParam.showPartVert.downTime = 120;
% GShowProfileParam.showPartVert.mode = 'up_down_time';
% GShowProfileParam.showPartVert.mode = 'in_2_horizons';
GShowProfileParam.showPartVert.horizonIds = [1, 3];
GShowProfileParam.showPartVert.mode = 'off';
GShowProfileParam.showPartVert.upTime = 40;
GShowProfileParam.showPartVert.downTime = 50;
GShowProfileParam.showPartVert.mode = 'up_down_time';

GShowProfileParam.isShowHorizon = 0;
bsShowInvProfiles(GInvParam, GShowProfileParam, invResults, [], timeLine);
set(gcf, 'position', [141         193        1580         797]);
% bsShowInvProfiles(GInvParam, GShowProfileParam, invResults, wellLogs, timeLine);
% set(gcf, 'position', [141         193        1580         797]);


